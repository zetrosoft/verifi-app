<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/AIEscrowMarketplace.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> AIEscrowMarketplace.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.55% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>56/58</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">67.35% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>66/98</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">94.74% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>18/19</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96.15% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>75/78</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">40×</span>
<span class="cline-any cline-yes">38×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-yes">33×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">12×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">38×</span>
<span class="cline-any cline-yes">37×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-yes">22×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">21×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">19×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-yes">18×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-yes">13×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-yes">10×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;
&nbsp;
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
&nbsp;
/**
 * @title AIEscrowMarketplace
 * @author Zetrosoft
 * @notice Kontrak ini mengelola alur kerja escrow untuk pekerjaan antara client dan freelancer,
 * dengan verifikasi otomatis yang dilakukan oleh AI Agent.
 */
contract AIEscrowMarketplace is Ownable, ReentrancyGuard {
&nbsp;
    // =================================================================
    // State Variables
    // =================================================================
&nbsp;
    address public aiAgentAddress;
    uint256 public nextJobId;
&nbsp;
    enum Status {
        Open,           // Job posted, open for bidding
        Assigned,       // Freelancer selected, awaiting deposit
        FundsDeposited, // Client has deposited, work can begin
        WorkSubmitted,  // Freelancer has submitted the work
        Verified,       // AI Agent has completed verification
        Disputed,       // Client disputes the work/verification
        Completed,      // Funds have been released
        Cancelled       // Cancelled
    }
&nbsp;
    struct Job {
        address payable client;
        address payable freelancer; // Will be set after a bid is accepted
        string title;
        string descriptionIPFSHash;
        uint256 price;
        uint256 deadline; // Unix timestamp
        string resultIPFSHash;
        Status status;
        string disputeReason; // Reason for dispute
    }
&nbsp;
    struct Bid {
        uint256 bidId;
        uint256 jobId;
        address payable freelancer;
        string proposalText;
    }
&nbsp;
    mapping(uint256 =&gt; Job) public jobs;
    mapping(uint256 =&gt; Bid[]) public bidsByJobId;
    mapping(address =&gt; uint256[]) public jobsByFreelancer;
    mapping(address =&gt; uint256[]) public jobsByClient;
&nbsp;
&nbsp;
    // =================================================================
    // Events
    // =================================================================
&nbsp;
    event JobPosted(uint256 indexed jobId, address indexed client, string title, uint256 price);
    event FundsDeposited(uint256 indexed jobId, uint256 price);
    event WorkSubmitted(uint256 indexed jobId, address indexed freelancer, string resultIPFSHash);
    event WorkVerified(uint256 indexed jobId, bool isApproved);
    event FundsReleased(uint256 indexed jobId, address indexed recipient, uint256 price);
    event AiAgentAddressUpdated(address indexed newAddress);
&nbsp;
    // =================================================================
    // Modifiers
    // =================================================================
&nbsp;
    modifier onlyAiAgent() {
        require(msg.sender == aiAgentAddress, "AIEscrow: Caller is not the AI Agent");
        _;
    }
&nbsp;
    modifier jobMustExist(uint256 _jobId) {
        require(jobs[_jobId].client != address(0), "AIEscrow: Job does not exist");
        _;
    }
&nbsp;
    modifier onlyClientOfJob(uint256 _jobId) {
        require(msg.sender == jobs[_jobId].client, "AIEscrow: Caller is not the job client");
        _;
    }
&nbsp;
&nbsp;
&nbsp;
    modifier onlyJobFreelancer(uint256 _jobId) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(jobs[_jobId].freelancer != address(0), "AIEscrow: Job does not exist");
        require(msg.sender == jobs[_jobId].freelancer, "AIEscrow: Caller is not the job freelancer");
        _;
    }
&nbsp;
    modifier atJobStatus(uint256 _jobId, Status _status) {
        require(jobs[_jobId].status == _status, "AIEscrow: Job is not in the required status");
        _;
    }
&nbsp;
    // =================================================================
    // Constructor &amp; Admin Functions
    // =================================================================
&nbsp;
    constructor(address _initialAiAgentAddress) Ownable(msg.sender) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_initialAiAgentAddress != address(0), "AIEscrow: Initial AI Agent address cannot be the zero address");
        aiAgentAddress = _initialAiAgentAddress;
        emit AiAgentAddressUpdated(_initialAiAgentAddress);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function setAiAgentAddress(address _newAiAgentAddress) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >        require(_newAiAgentAddress != address(0), "AIEscrow: New AI Agent address cannot be the zero address")</span>;
        aiAgentAddress = _newAiAgentAddress;
<span class="cstat-no" title="statement not covered" >        emit AiAgentAddressUpdated(_newAiAgentAddress);</span>
    }
&nbsp;
    // =================================================================
    // Core Functions
    // =================================================================
&nbsp;
    function postJob(
        string memory _title,
        string memory _descriptionIPFSHash,
        uint256 _price,
        uint256 _deadline
    ) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(bytes(_title).length &gt; 0, "AIEscrow: Job title cannot be empty");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(bytes(_descriptionIPFSHash).length &gt; 0, "AIEscrow: Work description IPFS hash cannot be empty");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_price &gt; 0, "AIEscrow: Price must be greater than zero");
        require(_deadline &gt; block.timestamp, "AIEscrow: Deadline must be in the future");
&nbsp;
        uint256 jobId = nextJobId;
        jobs[jobId] = Job({
            client: payable(msg.sender),
            freelancer: payable(address(0)), // Freelancer is not assigned yet
            title: _title,
            descriptionIPFSHash: _descriptionIPFSHash,
            price: _price,
            deadline: _deadline,
            resultIPFSHash: "",
            status: Status.Open,
            disputeReason: "" // Inisialisasi disputeReason
        });
&nbsp;
        jobsByClient[msg.sender].push(jobId);
        nextJobId++;
&nbsp;
        emit JobPosted(jobId, msg.sender, _title, _price);
    }
&nbsp;
    event BidSubmitted(uint256 indexed jobId, uint256 indexed bidId, address indexed freelancer, string proposalText);
&nbsp;
    function submitBid(uint256 _jobId, string memory _proposalText) external {
        Job storage job = jobs[_jobId];
        require(job.client != address(0), "AIEscrow: Job does not exist");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(job.status == Status.Open, "AIEscrow: Job is not open for bidding");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(bytes(_proposalText).length &gt; 0, "AIEscrow: Proposal text cannot be empty");
        require(msg.sender != job.client, "AIEscrow: Client cannot submit a bid on their own job");
&nbsp;
        uint256 bidId = bidsByJobId[_jobId].length; // Simple auto-incrementing bid ID per job
        bidsByJobId[_jobId].push(
            Bid({
                bidId: bidId,
                jobId: _jobId,
                freelancer: payable(msg.sender),
                proposalText: _proposalText
            })
        );
&nbsp;
        emit BidSubmitted(_jobId, bidId, msg.sender, _proposalText);
    }
&nbsp;
    event BidAccepted(uint256 indexed jobId, uint256 indexed bidId, address client, address freelancer);
&nbsp;
    function acceptBid(uint256 _jobId, uint256 _bidId) external jobMustExist(_jobId) onlyClientOfJob(_jobId) {
        Job storage job = jobs[_jobId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(job.status == Status.Open, "AIEscrow: Job is not open for bidding");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_bidId &lt; bidsByJobId[_jobId].length, "AIEscrow: Invalid bid ID");
&nbsp;
        Bid storage acceptedBid = bidsByJobId[_jobId][_bidId];
        job.freelancer = acceptedBid.freelancer;
        job.status = Status.Assigned;
&nbsp;
        jobsByFreelancer[acceptedBid.freelancer].push(_jobId);
&nbsp;
        emit BidAccepted(_jobId, _bidId, msg.sender, acceptedBid.freelancer);
    }
&nbsp;
    function getBidsForJob(uint256 _jobId) external view <span class="missing-if-branch" title="else path not taken" >E</span>jobMustExist(_jobId) returns (Bid[] memory) {
        return bidsByJobId[_jobId];
    }
&nbsp;
    function getJobCount() external view returns (uint256) {
        return nextJobId;
    }
&nbsp;
&nbsp;
&nbsp;
    function depositForJob(uint256 _jobId) external payable <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>jobMustExist(_jobId) onlyClientOfJob(_jobId) atJobStatus(_jobId, Status.Assigned) {
        Job storage job = jobs[_jobId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(msg.value == job.price, "AIEscrow: Incorrect deposit amount"); // Now checking against job.price
&nbsp;
        job.status = Status.FundsDeposited;
        emit FundsDeposited(_jobId, msg.value); // msg.value is the actual amount received
    }
&nbsp;
    function submitWork(uint256 _jobId, string memory _resultIPFSHash) external onlyJobFreelancer(_jobId) <span class="missing-if-branch" title="else path not taken" >E</span>atJobStatus(_jobId, Status.FundsDeposited) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(bytes(_resultIPFSHash).length &gt; 0, "AIEscrow: Result IPFS hash cannot be empty");
&nbsp;
        Job storage job = jobs[_jobId];
        job.resultIPFSHash = _resultIPFSHash;
        job.status = Status.WorkSubmitted;
        emit WorkSubmitted(_jobId, job.freelancer, _resultIPFSHash);
    }
&nbsp;
    event JobDisputed(uint256 indexed jobId, address indexed client, string reason);
&nbsp;
    function raiseDispute(uint256 _jobId, string memory _reason) external <span class="missing-if-branch" title="else path not taken" >E</span>jobMustExist(_jobId) onlyClientOfJob(_jobId) <span class="missing-if-branch" title="else path not taken" >E</span>atJobStatus(_jobId, Status.Verified) {
        Job storage job = jobs[_jobId];
        <span class="missing-if-branch" title="else path not taken" >E</span>require(bytes(_reason).length &gt; 0, "AIEscrow: Dispute reason cannot be empty");
&nbsp;
        job.status = Status.Disputed;
        job.disputeReason = _reason;
        emit JobDisputed(_jobId, msg.sender, _reason);
    }
&nbsp;
    event DisputeResolved(uint256 indexed jobId, bool releaseToFreelancer);
&nbsp;
    function resolveDispute(uint256 _jobId, bool _releaseToFreelancer) external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant <span class="missing-if-branch" title="else path not taken" >E</span>onlyAiAgent <span class="missing-if-branch" title="else path not taken" >E</span>atJobStatus(_jobId, Status.Disputed) {
        Job storage job = jobs[_jobId];
&nbsp;
        if (_releaseToFreelancer) {
            _releaseFunds(_jobId);
        } else {
            // Refund client
            job.status = Status.Cancelled;
            (bool success, ) = job.client.call{value: job.price}("");
            <span class="missing-if-branch" title="else path not taken" >E</span>require(success, "AIEscrow: Failed to refund client");
        }
        emit DisputeResolved(_jobId, _releaseToFreelancer);
    }
&nbsp;
    function verifyWork(uint256 _jobId, bool _isApproved) external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant onlyAiAgent <span class="missing-if-branch" title="else path not taken" >E</span>atJobStatus(_jobId, Status.WorkSubmitted) {
        Job storage job = jobs[_jobId];
        
        if (_isApproved) {
            job.status = Status.Verified;
        } else {
            job.status = Status.Cancelled;
            (bool success, ) = job.client.call{value: job.price}("");
            <span class="missing-if-branch" title="else path not taken" >E</span>require(success, "AIEscrow: Failed to refund client on rejection");
        }
&nbsp;
        emit WorkVerified(_jobId, _isApproved);
    }
&nbsp;
    function clientReleaseFunds(uint256 _jobId) external <span class="missing-if-branch" title="else path not taken" >E</span>nonReentrant jobMustExist(_jobId) onlyClientOfJob(_jobId) <span class="missing-if-branch" title="else path not taken" >E</span>atJobStatus(_jobId, Status.Verified) {
        _releaseFunds(_jobId);
    }
&nbsp;
    // =================================================================
    // Internal Functions
    // =================================================================
&nbsp;
    function _releaseFunds(uint256 _jobId) internal {
        Job storage job = jobs[_jobId];
        job.status = Status.Completed;
        (bool success, ) = job.freelancer.call{value: job.price}("");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(success, "AIEscrow: Failed to release funds to freelancer");
&nbsp;
        emit FundsReleased(_jobId, job.freelancer, job.price);
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Fri Dec 05 2025 11:21:18 GMT+0700 (Western Indonesia Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
